<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF Debug - Gomme</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="static/css/unified-pdf-viewer.css">
    <style>
        body { margin: 20px; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .debug-info { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin-bottom: 20px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 Test Debug PDF - Problème Gomme</h1>
        
        <div class="debug-info">
            <h5>Instructions de test :</h5>
            <ol>
                <li>Ouvre la console (F12)</li>
                <li>Clique sur "Charger PDF Test"</li>
                <li>Dessine avec le stylo</li>
                <li>Clique sur la gomme et observe les logs CSS</li>
                <li>Utilise <code>debugAnnotations()</code> dans la console</li>
            </ol>
        </div>

        <!-- Bouton pour charger un PDF test -->
        <div class="mb-3">
            <button id="loadTestPDF" class="btn btn-primary">📄 Charger PDF Test</button>
            <input type="file" id="pdfFile" accept=".pdf" style="display: none;">
        </div>

        <!-- Conteneur pour le PDF viewer -->
        <div id="pdf-viewer-container" style="height: 80vh; border: 1px solid #ddd;">
            <p class="text-center mt-5">Clique sur "Charger PDF Test" pour commencer</p>
        </div>
    </div>

    <!-- Scripts PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configuration PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Notre lecteur PDF unifié avec debug -->
    <script src="static/js/unified-pdf-viewer.js?v=1758543772&debug=true&test=standalone"></script>
    
    <script>
        let pdfViewer = null;

        // Charger un PDF test
        document.getElementById('loadTestPDF').addEventListener('click', () => {
            document.getElementById('pdfFile').click();
        });

        document.getElementById('pdfFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            console.log('🔧 Chargement du PDF test pour debug gomme...');

            // Initialiser le viewer
            if (!pdfViewer) {
                pdfViewer = new UnifiedPDFViewer('pdf-viewer-container', {
                    mode: 'teacher',
                    viewMode: 'continuous',
                    showThumbnails: true
                });

                // Exposer pour debug
                window.pdfViewer = pdfViewer;
                window.debugAnnotations = () => pdfViewer.debugAnnotationsState();
                console.log('🔧 Fonctions debug disponibles: window.debugAnnotations()');
            }

            // Charger le fichier
            const arrayBuffer = await file.arrayBuffer();
            const uint8Array = new Uint8Array(arrayBuffer);
            
            try {
                await pdfViewer.loadPDF(uint8Array, file.name);
                console.log('✅ PDF chargé - Tu peux maintenant tester la gomme !');
                console.log('🎯 1. Dessine avec le stylo');
                console.log('🎯 2. Clique sur la gomme');
                console.log('🎯 3. Observe les logs CSS détaillés');
            } catch (error) {
                console.error('❌ Erreur chargement PDF:', error);
            }
        });

        // Message de bienvenue
        console.log('🔧 PAGE DE TEST DEBUG GOMME CHARGÉE');
        console.log('📄 Charge un PDF avec le bouton pour commencer');
    </script>
</body>
</html>